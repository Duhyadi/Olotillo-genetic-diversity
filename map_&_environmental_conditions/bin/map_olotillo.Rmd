---
title: "Olotillo_map"
output: html_document
---

# Title: Plot map with maptools, rgeos and rgdal.

# Star date: October 2023 by Alicia Mastretta-Yanes.

# Previous modification: Mon 24/Jun/2024. Coacalco, Mexico (12:07 PM) by Duhyadi Oliva.

# Last modification: Wed 08/Oct/2025. Versoix, Switzerland (15:00 PM) by Duhyadi Oliva-Garc√≠a.

# Authors: Duhyadi Oliva-Garc√≠a & Alicia Mastretta-Yanes.

------------------------------------------------------------------------

```{r setup, include=FALSE}

# Configuraci√≥n inicial del proyecto -----------------------------------------

# Cargar el paquete here (para rutas reproducibles)
if (requireNamespace("here", quietly = TRUE)) {
  setwd(here::here())
  message("üìÇ Directorio de trabajo fijado en: ", getwd())
} else {
  stop("‚ö†Ô∏è El paquete 'here' no est√° instalado. Ejecuta install.packages('here')")
}

```

# LOAD LIBRARIES
```{r}
library(dplyr)
library(ggplot2)
#library(gpclib) # ya no funciona, se puede sustituir con el uso de sf 
# library(maptools) # al igual que gpclib, el paquete maptools fue retirado de CRAN en 2023.
# library(rgeos) # en proceso de retiro
#library(rgdal) #el paquete rgdal tambi√©n fue retirado oficialmente de CRAN en 2023 (junto con rgeos y maptools).
library(sf)

```
Note: Ya no se usa gpclib y maptools,la mayor√≠a de sus funciones se han migrado a otros paquetes m√°s modernos ‚Äî principalmente sf, sp, y rgeos (aunque rgeos tambi√©n est√° en proceso de retiro).


# LOAD DATA: read shape and points
```{r}
# SHAPES
# Mexico shape
mexico <- st_read(here::here("shape","destdv1gw" ,"destdv1gw.shp"))
# Olotillo distribution shape 
distribution <- st_read(here::here("shape","oloti_7cgw" ,"oloti_7cgw.shp"))
# POINTS
# Olotillo, Proyecto Global Ma√≠ces Nativos (PGMN)
olotillo.PGMN <- read.csv(here::here("meta","olotillo_PGMN_siagro.csv"))
# Olotillo, Proyecto Doctoral Poblaciones Evolutivas" 
olotillo.points <- read.csv(here::here("meta", "olotillo_points_meta_clean.csv"))
```

## PLOT

Occurrence points for Olotillo, were collected in the field for, 2018-2019 : Duhyadi (Chiapas), Alicia (Chiapas), Bulmaro (Chiapas), Flavio (Oaxaca), No√© (Guerrero), V√≠ctor (Nayarit) and Hugo (Chiapas-different year). Also include samples from CIMMYTM.

### Map 1: Potential distribution of olotillo according to Perales & Golicher (2014) + points for olotillo, from the Global Maize Project (CONABIO, 2011) + accessions sampled for this study by race.

```{r}
# shape file for mexico and potential distribution
map <- ggplot() + 
       geom_polygon(data = mexico, # shape-mexico
                    aes(x = long, y = lat, group = group), 
                   colour = "grey", fill = NA) + theme_void() +
  geom_polygon(data = distribution, size=0.2, # shape-distri.
                    aes(x = long, y = lat, group = group), 
                    colour = "blue", fill = NA) + theme_void()
# shape file for olotillo, PGMN and and the collections for this study
map + geom_point(data = olotillo.PGMN, # points-olo.PGMN
                 size= 0.5, colour = "black",
                 aes(x=longitud, y=latitud)) +
  geom_point(data = olotillo.points, size=1.5, # points-study
           aes(x = longitude, y = latitude, shape= Race, color= Race)) +
  scale_shape_manual(values = c(15, 17, 16, 18)) +
  scale_color_manual(values = c("purple", "green", "red", "orange")) 
```

### Map 2: Potential distribution of olotillo according to Perales & Golicher (2014) + sampling points for Olotillo from the Global Maize Project (CONABIO, 2011). Figure 1 a of the paper 1. Distribution and environmental conditions where Olotillo is grown. a) Potential distribution of Olotillo according to Perales & Golicher (2014) and sampling points for Olotillo from the Global Maize Project (CONABIO, 2011)

```{r}
# shape file for mexico and potential distribution
map <- ggplot() + 
       geom_polygon(data = mexico, # shape-mexico
                    aes(x = long, y = lat, group = group), 
                   colour = "grey", fill = NA) + theme_void() +
  geom_polygon(data = distribution, size=1, # shape-distri.
                    aes(x = long, y = lat, group = group), 
                    colour = "purple", fill = NA) + theme_void()
# shape file for siagro and olotillo points  
map + geom_point(data = olotillo.PGMN, # points-olo.PGMN 
                 size= 0.5, colour = "black",
                 aes(x=longitud, y=latitud)) 
```

### Map 3: Map of Mexico highligthing states that were sampled (same colors than PCA)

```{r}
library(broom)
packageVersion("broom")
```

#### Color by states

```{r}
#install.packages("units")
library(sf)
```

### Sun 23 jun 2024

```{r}
mexico_sf <- st_as_sf(mexico, region = "ENTIDAD")
lapply(mexico_sf, class)
print(mexico_sf)
```

```{r}
# transform shape to df
# broom package, convert statistical objects into Tidy Tibbles 
mexico_df <- broom::tidy(mexico, region = "ENTIDAD")
lapply(mexico_df, class)
```

### Pop data

```{r}
# read the file plate1_fullmeta.txt
pop.data <- read.table("meta/plate1_fullmeta.txt", sep = "\t", header = TRUE, stringsAsFactors = FALSE)
# order alphabetically pop.data
pop.data <- pop.data[order(pop.data$sample_name),]
# remove the first element, (DNA BLANK)
pop.data <- pop.data[-1,]
# check n samples
dim(pop.data)
```

```{r}
# make vector of states excluding where we sampled olotillos
sampled.states<-unique(pop.data$state)
sampled.states
```

```{r}
library(ggplot2)
```

```{r}
# to get a names in the data frame
# unique(mexico_df$id) # code original Alicia
unique(mexico_sf$ENTIDAD) # logica Duhyadi jun 2024
# change to they way 
sampled.states<-c("CAMPECHE", "CHIAPAS", "GUERRERO", "HIDALGO",
                  "NAYARIT", "OAXACA", "QUINTANA ROO", "SAN LUIS POTOSI",
                  "VERACRUZ DE IGNACIO DE LA LLAVE")

# not.sampled<-unique(mexico_sf$id)[!unique(mexico_sf$id) %in% sampled.states] # code original Alicia

not.sampled<-unique(mexico_sf$ENTIDAD)[!unique(mexico_sf$ENTIDAD) %in% sampled.states] #logica Duhyadi jun 2024  
  
## Map showing only sampled states

map2 <- ggplot()  +
       geom_polygon(data = mexico_sf, 
                    aes(x = long, y = lat, group = group, fill =ENTIDAD ), #fill =id ),
                    colour = "grey") + theme_void() +
                    theme(legend.position="none") +
                    scale_fill_manual(breaks = c(sampled.states, not.sampled),
                                      values = c("grey60", # 9 color-blind friendly cols
                                                "#75a842",
                                                "#36dee6",
                                                "#52bd85",
                                                "#b94656",
                                                "#6780d8",
                                                "#c69c39",
                                                "#b6b638",
                                                "#89863c",
                                                # the rest leave blank
                                                rep("white", 23)))# +


#  geom_polygon(data = distribution, 
                   # aes(x = long, y = lat, group = group), 
                   # colour = "blue", fill = NA) + theme_void()
map2 
```

```{r}

```

# Add sampling points of Olotillo from PGMN

```{r}
map3 <- ggplot() + 
        geom_polygon(data = mexico_df, show.legend=FALSE,
              aes(x = long, y = lat, group = group, fill =id ), 
              colour = "grey") + 
              # theme(legend.position="none") +
              scale_fill_manual(breaks = c(sampled.states, not.sampled),
                                values = c("grey60", # 9 color-blind friendly cols
                                          "#75a842",
                                          "#36dee6",
                                          "#52bd85",
                                          "#b94656",
                                          "#6780d8",
                                          "#c69c39",
                                          "#b6b638",
                                          "#89863c",
                                          # the rest leave blank
                                          rep("white", 23))) + theme_void()
#shape file for siagro and olotillo points  
map3 + geom_point(data = olotillo.PGMN,
                 size=0.4, colour = "black",
                 aes(x=longitud, y=latitud)) +
        geom_polygon(data = distribution, size=0.1,
                    aes(x = long, y = lat, group = group), 
                    colour = "pink", fill = NA) + 
  geom_point(data = olotillo.points, size=1.5,
           aes(x = longitude, y = latitude, shape= Race, color= Race)) +
  scale_shape_manual(values = c(15, 17, 16, 18)) +
  scale_color_manual(values = c("purple", "green", "blue", "yellow"))  +
  theme()
```

########29Dic2023#######################################################

```{r}
map3 <- ggplot() + 
        geom_polygon(data = mexico_df, show.legend=FALSE,
              aes(x = long, y = lat, group = group, fill =id ), 
              colour = "grey") + 
              # theme(legend.position="none") +
              scale_fill_manual(breaks = c(sampled.states, not.sampled),
                                values = c("grey60", # 9 color-blind friendly cols
                                          "#75a842",
                                          "#36dee6",
                                          "#52bd85",
                                          "#b94656",
                                          "#6780d8",
                                          "#c69c39",
                                          "#b6b638",
                                          "#89863c",
                                          # the rest leave blank
                                          rep("white", 23))) + theme_void()
#shape file for siagro and olotillo points  
map3 + geom_point(data = olotillo.PGMN,
                 size=0.4, colour = "black",
                 aes(x=longitud, y=latitud)) + 
  geom_point(data = olotillo.points, size=1.5,
           aes(x = longitude, y = latitude, shape= Race, color= Race)) +
  scale_shape_manual(values = c(15, 17, 16, 18)) +
  scale_color_manual(values = c("purple", "green", "blue", "yellow"))  +
  theme()
```

```{r}
map + geom_point(data = olotillo.points, size = 1,
           aes(x = longitude, y = latitude, shape= Race, color= Race)) 
```

```{r}
olotillo.points$Race
```
