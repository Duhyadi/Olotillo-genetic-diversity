---
title: "Olotillo_map"
output: html_document
---

# Title: Plot map with maptools, rgeos and rgdal.
# Star date: October 2023 by ALicia Mastretta-Yanes.
# Previous modification: Wed 08/Oct/2025. Versoix, Switzerland (15:00 PM) by Duhyadi Oliva-Garc√≠a.
# Last modification: Fri 10/Oct/2025. Geneva, Switzerland (16:28) by Duhyadi Oliva-
# Authors: Duhyadi Oliva-Garc√≠a & Alicia Mastretta-Yanes.

------------------------------------------------------------------------

```{r setup, include=FALSE}
# Initial project setup-----------------------------------------
# Load the package here (for reproducible routes)
if (requireNamespace("here", quietly = TRUE)) {
  setwd(here::here())
  message("üìÇ  Working directory set to: ", getwd())
} else {
  stop("‚ö†Ô∏è The 'here' package is not installed. Execute install.packages('here')")
}
```

------------------------------------------------------------------------

# LOAD LIBRARIES
```{r}
library(dplyr)
library(ggplot2)
# library(gpclib) # officially retired from CRAN in 2023, replace with sf
# library(maptools) # like gpclib, the maptools package was removed from CRAN in 2023, replace with sf
# library(rgeos) # in the process of retirement, replace with sf 
#library(rgdal) # was also officially retired from CRAN in 2023 (along with rgeos and maptools, replace with sf 
library(sf)
```
Note #1: gpclib and maptools are no longer used; most of their functions have been migrated to other, more modern packages ‚Äî primarily sf, sp, and rgeos (although rgeos is also in the process of being retired).

# LOAD DATA: read shape and points
```{r}
# SHAPES
# Mexico shape
mexico <- st_read(here::here("shape","destdv1gw" ,"destdv1gw.shp"))
# Olotillo distribution shape 
distribution <- st_read(here::here("shape","oloti_7cgw" ,"oloti_7cgw.shp"))
# POINTS
# Olotillo, Proyecto Global Ma√≠ces Nativos (PGMN)
olotillo.PGMN <- read.csv(here::here("meta","olotillo_PGMN_siagro.csv"))
# Olotillo, Proyecto Doctoral Poblaciones Evolutivas" 
olotillo.points <- read.csv(here::here("meta", "olotillo_points_meta_clean.csv"))
```
Note #2: here::here. It's the safe way to call package here.
# PLOT
Occurrence points for Olotillo, were collected in the field for, 2018-2019 : Duhyadi Oliva-Garc√≠a(Chiapas), Alicia Mastretta-Yanes(Chiapas), Bulmaro Couti√±o-Estrada (Chiapas), Flavio Arag√≥n-Cuevas (Oaxaca), No√© Orlando-G√≥mez (Guerrero), V√≠ctor Antonio Vidal Mart√≠nez (Nayarit) and Hugo Perales-Rivera (Chiapas-different year). Also include samples from CIMMYTM.
## MAP #1 
Potential distribution of olotillo according to Perales & Golicher (2014) + points for olotillo, from the Global Maize Project (CONABIO, 2011) + accessions sampled for this study by race.
```{r}
map <- ggplot() +
  geom_sf(data = mexico, colour = "grey", fill = NA) + # shape mexico
  geom_sf(data = distribution, colour = "blue", fill = NA, size = 0.2) + # shape distribution
  geom_point(data = olotillo.PGMN, aes(x = longitud, y = latitud), size = 0.5, colour = "black") +
  geom_point(data = olotillo.points, aes(x = longitude, y = latitude, shape = Race, color = Race), size = 1.5) +
  scale_shape_manual(values = c(15, 17, 16, 18)) +
  scale_color_manual(values = c("purple", "green", "red", "orange")) +
  theme_void()

map
```



## MAP #2
Potential distribution of olotillo according to Perales & Golicher (2014) + sampling points for Olotillo from the Global Maize Project (CONABIO, 2011). Figure 1 a of the paper 1. Distribution and environmental conditions where Olotillo is grown. a) Potential distribution of Olotillo according to Perales & Golicher (2014) and sampling points for Olotillo from the Global Maize Project (CONABIO, 2011)
```{r}
# shape file for mexico and potential distribution
map <- ggplot() + 
       geom_polygon(data = mexico, # shape-mexico
                    aes(x = long, y = lat, group = group), 
                   colour = "grey", fill = NA) + theme_void() +
  geom_polygon(data = distribution, size=1, # shape-distri.
                    aes(x = long, y = lat, group = group), 
                    colour = "purple", fill = NA) + theme_void()
# shape file for siagro and olotillo points  
map + geom_point(data = olotillo.PGMN, # points-olo.PGMN 
                 size= 0.5, colour = "black",
                 aes(x=longitud, y=latitud)) 
```

### Map 3: Map of Mexico highligthing states that were sampled (same colors than PCA)

```{r}
library(broom)
packageVersion("broom")
```

#### Color by states

```{r}
#install.packages("units")
library(sf)
```

### Sun 23 jun 2024

```{r}
mexico_sf <- st_as_sf(mexico, region = "ENTIDAD")
lapply(mexico_sf, class)
print(mexico_sf)
```

```{r}
# transform shape to df
# broom package, convert statistical objects into Tidy Tibbles 
mexico_df <- broom::tidy(mexico, region = "ENTIDAD")
lapply(mexico_df, class)
```

### Pop data

```{r}
# read the file plate1_fullmeta.txt
pop.data <- read.table("meta/plate1_fullmeta.txt", sep = "\t", header = TRUE, stringsAsFactors = FALSE)
# order alphabetically pop.data
pop.data <- pop.data[order(pop.data$sample_name),]
# remove the first element, (DNA BLANK)
pop.data <- pop.data[-1,]
# check n samples
dim(pop.data)
```

```{r}
# make vector of states excluding where we sampled olotillos
sampled.states<-unique(pop.data$state)
sampled.states
```

```{r}
library(ggplot2)
```

```{r}
# to get a names in the data frame
# unique(mexico_df$id) # code original Alicia
unique(mexico_sf$ENTIDAD) # logica Duhyadi jun 2024
# change to they way 
sampled.states<-c("CAMPECHE", "CHIAPAS", "GUERRERO", "HIDALGO",
                  "NAYARIT", "OAXACA", "QUINTANA ROO", "SAN LUIS POTOSI",
                  "VERACRUZ DE IGNACIO DE LA LLAVE")

# not.sampled<-unique(mexico_sf$id)[!unique(mexico_sf$id) %in% sampled.states] # code original Alicia

not.sampled<-unique(mexico_sf$ENTIDAD)[!unique(mexico_sf$ENTIDAD) %in% sampled.states] #logica Duhyadi jun 2024  
  
## Map showing only sampled states

map2 <- ggplot()  +
       geom_polygon(data = mexico_sf, 
                    aes(x = long, y = lat, group = group, fill =ENTIDAD ), #fill =id ),
                    colour = "grey") + theme_void() +
                    theme(legend.position="none") +
                    scale_fill_manual(breaks = c(sampled.states, not.sampled),
                                      values = c("grey60", # 9 color-blind friendly cols
                                                "#75a842",
                                                "#36dee6",
                                                "#52bd85",
                                                "#b94656",
                                                "#6780d8",
                                                "#c69c39",
                                                "#b6b638",
                                                "#89863c",
                                                # the rest leave blank
                                                rep("white", 23)))# +


#  geom_polygon(data = distribution, 
                   # aes(x = long, y = lat, group = group), 
                   # colour = "blue", fill = NA) + theme_void()
map2 
```

```{r}

```

# Add sampling points of Olotillo from PGMN

```{r}
map3 <- ggplot() + 
        geom_polygon(data = mexico_df, show.legend=FALSE,
              aes(x = long, y = lat, group = group, fill =id ), 
              colour = "grey") + 
              # theme(legend.position="none") +
              scale_fill_manual(breaks = c(sampled.states, not.sampled),
                                values = c("grey60", # 9 color-blind friendly cols
                                          "#75a842",
                                          "#36dee6",
                                          "#52bd85",
                                          "#b94656",
                                          "#6780d8",
                                          "#c69c39",
                                          "#b6b638",
                                          "#89863c",
                                          # the rest leave blank
                                          rep("white", 23))) + theme_void()
#shape file for siagro and olotillo points  
map3 + geom_point(data = olotillo.PGMN,
                 size=0.4, colour = "black",
                 aes(x=longitud, y=latitud)) +
        geom_polygon(data = distribution, size=0.1,
                    aes(x = long, y = lat, group = group), 
                    colour = "pink", fill = NA) + 
  geom_point(data = olotillo.points, size=1.5,
           aes(x = longitude, y = latitude, shape= Race, color= Race)) +
  scale_shape_manual(values = c(15, 17, 16, 18)) +
  scale_color_manual(values = c("purple", "green", "blue", "yellow"))  +
  theme()
```

########29Dic2023#######################################################

```{r}
map3 <- ggplot() + 
        geom_polygon(data = mexico_df, show.legend=FALSE,
              aes(x = long, y = lat, group = group, fill =id ), 
              colour = "grey") + 
              # theme(legend.position="none") +
              scale_fill_manual(breaks = c(sampled.states, not.sampled),
                                values = c("grey60", # 9 color-blind friendly cols
                                          "#75a842",
                                          "#36dee6",
                                          "#52bd85",
                                          "#b94656",
                                          "#6780d8",
                                          "#c69c39",
                                          "#b6b638",
                                          "#89863c",
                                          # the rest leave blank
                                          rep("white", 23))) + theme_void()
#shape file for siagro and olotillo points  
map3 + geom_point(data = olotillo.PGMN,
                 size=0.4, colour = "black",
                 aes(x=longitud, y=latitud)) + 
  geom_point(data = olotillo.points, size=1.5,
           aes(x = longitude, y = latitude, shape= Race, color= Race)) +
  scale_shape_manual(values = c(15, 17, 16, 18)) +
  scale_color_manual(values = c("purple", "green", "blue", "yellow"))  +
  theme()
```

```{r}
map + geom_point(data = olotillo.points, size = 1,
           aes(x = longitude, y = latitude, shape= Race, color= Race)) 
```

```{r}
olotillo.points$Race
```
